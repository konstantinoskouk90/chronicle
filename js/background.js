chrome.runtime.onMessage.addListener(function(e,t,a){"content"===e.from&&(e.found?(delete localStorage.playlist_scanned,localStorage.setItem("playlist_scanned",e.data)):delete localStorage.playlist_scanned,chrome.runtime.sendMessage({data:"VIDEOS_SCANNED"}))});var chromeExtension={activeTab:function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){/^chrome\:\/\//.test(e[0].url)?chrome.runtime.sendMessage({data:"CANNOT_SCAN_PAGE"}):chrome.tabs.executeScript(e[0].id,{file:"js/content.js"})})},constrObj:function(e,t,a,s,i,l,n,o,r,c,d){var m,p={},_=JSON.parse(localStorage.playlist),E=Object.keys(_);switch(E.length?(_[e]={},_[e].date_modified=t,_[e].description=a,_[e].status=s,_[e].lastAdded=i,_[e].plays=l,_[e].videos=n,_[e].thumbnails=o,_[e].image=r,_[e].link=c,localStorage.setItem("playlist",JSON.stringify(_))):(p[e]={},p[e].date_modified=t,p[e].description=a,p[e].status=s,p[e].lastAdded=i,p[e].plays=l,p[e].videos=n,p[e].thumbnails=o,p[e].image=r,p[e].link=c,localStorage.setItem("playlist",JSON.stringify(p))),d){case"ADD_VIDEO":m="ADDED_VIDEO";break;case"PLAY_PLAYLIST":m="PLAYED_PLAYLIST";break;case"CREATE_PLAYLIST":m="CREATED_PLAYLIST";break;case"SAVE_PLAYLIST":m="SAVED_PLAYLIST";break;case"SAVE_VIDEO_THUMB":m="SAVED_VIDEO_THUMB";break;case"SAVE_VIDEO_POS_THUMB":m="SAVED_VIDEO_POS_THUMB";break;case"DELETE_VIDEO":m="DELETED_VIDEO";break;case"SCAN_ADD_VIDEO":m="SCANNED_ADDED_VIDEO"}void 0!==d&&chrome.runtime.sendMessage({data:m})},updatePlaylist:function(e){chrome.tabs.query({active:!0,currentWindow:!0},function(t){var a=JSON.parse(localStorage.playlist)[e.playlist_name].link||"",s=JSON.parse(localStorage.playlist)[e.playlist_name].videos;if(/\/\/www\.youtube\.com\/watch.*v\=/.test(t[0].url)){var i=t[0].url.match(/watch.*v\=([^&]+)/)[1];if(a.length){var l=new RegExp(i);!l.test(a)&&50>s?(e.playlist=a.match(/video_ids=(.*)/)[1]+","+i,chromeExtension.createPlaylist(e)):50===s?chrome.runtime.sendMessage({data:"MAX_VIDEO"}):l.test(a)&&chrome.runtime.sendMessage({data:"VIDEO_EXISTS"})}else e.playlist=i,chromeExtension.createPlaylist(e)}else chrome.runtime.sendMessage({data:"INVALID_PAGE"})})},createPlaylist:function(e){var t,a,s,i,l,n,o,r;r=void 0!==e.playlist?e.playlist:"",o=void 0!==e.playlist_plays?e.playlist_plays:"0",n=void 0!==e.thumbnails?e.thumbnails:"",t=e.playlist_name,a=e.playlist_description,s=e.playlist_image;var c=new Date;if(r.length){i="https://www.youtube.com/watch_videos?&title="+t+"&video_ids="+r;var d="https://www.youtube.com/embed/"+r.split(",")[r.split(",").length-1];status="enabled",l=r.split(",").length,xhr=new XMLHttpRequest,xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&(void 0!==JSON.parse(xhr.responseText).title?chromeExtension.constrObj(t,c,a,status,encodeURIComponent(JSON.parse(xhr.responseText).title),o,l,n,s,i,e.playlist_action):("ADD_VIDEO"===e.playlist_action&&chrome.runtime.sendMessage({data:"VIDEO_UNAVAILABLE"}),"PLAY_PLAYLIST"===e.playlist_action&&chromeExtension.constrObj(t,c,a,status,encodeURIComponent(JSON.parse(xhr.responseText).title),o,l,n,s,i,e.playlist_action)))},xhr.open("GET","https://noembed.com/embed?format=json&url="+encodeURIComponent(d)),xhr.send()}else{i="",status="disabled",l=0,n="";var m="";this.constrObj(t,c,a,status,m,o,l,n,s,i,e.playlist_action)}}};